# Тестовое задание
### Описание
Севрис по поиску текса

### Команда для клонирования
Клонируйте репозиторий командой в терминале:
`git clone https://github.com/ADYason/analytics_test.git`

### Команды для развертывания проекта
Cоздать и активировать виртуальное окружение:
`python3 -m venv venv`

* Если у вас Linux/MacOS

	`source venv/bin/activate`

* Если у вас windows

	`source venv/scripts/activate`

Установить зависимости из файла requirements.txt:
`python3 -m pip install --upgrade pip`

`pip install -r requirements.txt`

### Команды для развертывания эластики
В корневой дирректории проекта лежит `docker-compose.yaml`
Его необходимо поднять командой `docker-compose up`
Для корректной работы сервиса он должен быть всегда поднят.

### Команды для развертывания севриса
В корневой дирректории проекта нужно создать `.env` файл по образцу:
- `FLASK_APP=an_app` - название исполняемой дирректории, менять не нужно;
- `FLASK_DEBUG=false` - можно переключить флажок, если нужно посмотреть логи;
- `DATABASE_URI=sqlite:///db.sqlite3` - настройка бд sqlite, менять не нужно;
- `SECRET_KEY=ADWADSDWASDFXCQ` - ключ проекта, менять не нужно;
- `ELASTIC_HOST=http://127.0.0.1:9200` - host для эластики, менять не нужно;
При первом запуске до создания и наполнения БД необходимо использовать команды:
- `flask shell`
- `>>> from an_app import db`
- `>>> db.create_all()`
Таким образом будет создана бд и табличка `file_model`
Далее необходимо заполнить бд тестовыми данными.
Для этого создана отдельная cli команда:
- `flask load_files`
После этого используем команду:
- `flask run`
API будет находится по адресу `http://127.0.0.1:5000` 

### Работа с сервисом
API имеет 5 эндпоинтов, 3 из которых служебные:
- `/api/create_indice` Создание индекса в эластике [GET];
- `/api/delete_indice` Удалениея индекса в эластике [GET];
- `/api/fill_indice` Наполнение индекса данными из бд [GET];
- `/api/search` Поисковик по тексту [POST], образец payload: `{"text": "string"}`
- `/api/file/{pk}` Удаление из бд и эластики документа по id, где `pk:int` [DELETE]
### Тесты
Для корректной работы тестов необходима поднятая эластика и пустая бд.
Тесты запускаются командой `pytest`.



### Технологии
- Flask
- SQLAlchemy
- SQLite
- Elasticsearch
- Pytest
- dotenv
- Docker
- click

### Автор
Ярослав Горяинов